<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book a Service</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title mb-4">Select Services</h3>
        <form id="bookingForm">
          <div class="form-group">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="matterport">
              <label class="form-check-label" for="matterport">Matterport</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="floorplan">
              <label class="form-check-label" for="floorplan">Floor Plan</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="photos">
              <label class="form-check-label" for="photos">Photos</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="drone">
              <label class="form-check-label" for="photos">Drone</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="social">
              <label class="form-check-label" for="social">Social Media Video</label>
            </div>
          </div>

          <div class="form-group">
            <label for="sqft">Square Footage</label>
            <select id="sqft" class="form-control" required>
              <option value="">-- Select Size --</option>
              <option value="lt1500">Less than 1500</option>
              <option value="1501-3000">1501 - 3000</option>
              <option value="3001-3999">3001 - 3999</option>
              <option value="gt3000">Greater than 4000</option>
            </select>
          </div>

          <!-- NEW: Vacant Property Dropdown -->
          <div class="form-group">
            <label for="vacant">Is the property Vacant?</label>
            <select id="vacant" class="form-control" required>
              <option value="">-- Choose One --</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>

          <div class="alert alert-warning d-none" id="socialNote">
            To book a Social Media Video, please call Cory or Huy directly.
          </div>

          <button type="submit" id="nextBtn" class="btn btn-primary">Continue to Booking</button>
        </form>
      </div>
    </div>
  </div>
  <script>
/* ======= Paste all lines from active_services.txt here ======= */
const activeServices = [
`Drone-15|--15|---P0.0|---D0|----[727483]`,
`Drone-15|--15|---P0.0|---D0|VACANT|----[727490]`,
/* ... paste ALL LINES from your active_services.txt here ... */
];

/* Service duration mapping from your table */
const durations = {
  "Matterport": [60, 90, 120, 180],
  "FloorPlan": [0, 0, 0, 0], // always 0
  "Photos": [15, 30, 45, 60],
  "Drone": [15, 15, 15, 15], // always 15
  "SocialVideo": [30, 30, 30, 30], // always 30
};

const serviceOrder = ["Drone", "FloorPlan", "Matterport", "Photos", "SocialVideo"];

// Map your select value to index
function sqftToIdx(sqft) {
  if (sqft === "lt1500") return 0;
  if (sqft === "1501-3000") return 1;
  if (sqft === "3001-3999") return 2;
  if (sqft === "gt3000") return 3;
  return 0;
}

document.getElementById("bookingForm").onsubmit = function(e) {
  e.preventDefault();
  const sqft = document.getElementById("sqft").value;
  const vacant = document.getElementById("vacant").value;

  if (!sqft) {
    alert("Please select square footage.");
    return;
  }
  if (!vacant) {
    alert("Please indicate if the property is vacant.");
    return;
  }

  // Build chosen services, preserving order
  const selections = {
    "Drone": document.getElementById("drone").checked,
    "FloorPlan": document.getElementById("floorplan").checked,
    "Matterport": document.getElementById("matterport").checked,
    "Photos": document.getElementById("photos").checked,
    "SocialVideo": document.getElementById("social").checked,
  };

  // Square footage index
  const idx = sqftToIdx(sqft);

  // Build key
  let parts = [];
  for (const service of serviceOrder) {
    if (selections[service]) {
      // Use highest available duration if index is out of range
      const durArr = durations[service];
      let duration = durArr[Math.min(idx, durArr.length-1)];
      parts.push(service + "-" + duration);
    }
  }
  if (parts.length === 0) {
    alert("Please select at least one service.");
    return;
  }

  // Compose key
  let key = parts.join("|");
  if (vacant === "yes") key += "|VACANT";

  // Find matching line
  let found = null;
  for (const line of activeServices) {
    if (line.startsWith(key + "|") || line === key || line.startsWith(key + "|----") ) {
      found = line;
      break;
    }
  }

  if (!found) {
    alert("No matching service combination found. Please contact the office.");
    return;
  }

  // Extract service id
  const match = found.match(/\[(\d+)\]/);
  if (!match) {
    alert("No service ID found for this selection.");
    return;
  }
  const serviceId = match[1];

  // Redirect
  window.location.href = `https://booking99.timetap.com/?rid=${serviceId}#/`;
};
</script>

</body>
</html>
